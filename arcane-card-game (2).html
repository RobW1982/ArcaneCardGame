<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcane Card Reading</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple shared storage using localStorage + polling
        // For production, you'd want to use a real database/backend
        const storage = {
            get: (key) => {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        const CardFlipGame = () => {
            const [cards, setCards] = useState([]);
            const [flipped, setFlipped] = useState([]);
            const [loading, setLoading] = useState(true);
            const [flipping, setFlipping] = useState(false);
            const [gameCount, setGameCount] = useState(0);

            useEffect(() => {
                loadGameState();
                const interval = setInterval(loadGameState, 500);
                return () => clearInterval(interval);
            }, []);

            const loadGameState = () => {
                const state = storage.get('card-game-state');
                if (state) {
                    setCards(state.cards);
                    setFlipped(state.flipped);
                    setGameCount(state.gameCount);
                } else {
                    resetGame(1);
                }
                setLoading(false);
            };

            const resetGame = (count = gameCount + 1) => {
                let newCards;
                
                // Every 4th game (4, 8, 12, etc.) - all frowning faces
                if (count % 4 === 0) {
                    newCards = Array(6).fill('üòà');
                } else {
                    newCards = ['üòè', 'üòè', 'üòè', 'üòà', 'üòà', 'üòà'];
                    for (let i = newCards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newCards[i], newCards[j]] = [newCards[j], newCards[i]];
                    }
                }
                
                const newState = {
                    cards: newCards,
                    flipped: Array(6).fill(false),
                    gameCount: count
                };
                
                storage.set('card-game-state', newState);
                setCards(newCards);
                setFlipped(Array(6).fill(false));
                setGameCount(count);
            };

            const flipCard = (index) => {
                if (flipped[index] || flipping) return;

                setFlipping(true);
                
                const newFlipped = [...flipped];
                newFlipped[index] = true;
                
                const newState = {
                    cards: cards,
                    flipped: newFlipped,
                    gameCount: gameCount
                };
                
                storage.set('card-game-state', newState);
                setFlipped(newFlipped);

                // Show the card for 2 seconds, then flip back, then reset
                setTimeout(() => {
                    // Flip all cards back to front
                    const allUnflipped = {
                        cards: cards,
                        flipped: Array(6).fill(false),
                        gameCount: gameCount
                    };
                    storage.set('card-game-state', allUnflipped);
                    setFlipped(Array(6).fill(false));
                    
                    // Wait for flip animation to complete, then reset with new cards
                    setTimeout(() => {
                        resetGame();
                        setFlipping(false);
                    }, 700); // Match the flip animation duration
                }, 2000);
            };

            const arcaneSymbols = ['‚òΩ', '‚ú¶', '‚öù', '‚õ§', '‚õß', '‚óâ'];

            if (loading) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-black">
                        <div className="text-purple-300 text-2xl animate-pulse">Conjuring cards...</div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-black p-8">
                    <h1 className="text-5xl font-bold text-purple-300 mb-4 drop-shadow-lg" style={{textShadow: '0 0 20px rgba(168, 85, 247, 0.8)'}}>
                        Arcane Card Reading
                    </h1>
                    
                    <div className="text-purple-200 mb-8 text-center">
                        <p className="text-lg mb-2">Click any card to reveal your fate...</p>
                    </div>

                    <div className="grid grid-cols-3 gap-8 mb-8">
                        {cards.map((symbol, index) => (
                            <div
                                key={index}
                                onClick={() => flipCard(index)}
                                className={`relative w-28 h-40 cursor-pointer ${
                                    flipping ? 'pointer-events-none' : ''
                                }`}
                                style={{ perspective: '1000px' }}
                            >
                                <div
                                    className="relative w-full h-full transition-all duration-700"
                                    style={{
                                        transformStyle: 'preserve-3d',
                                        transform: flipped[index] ? 'rotateY(180deg)' : 'rotateY(0deg)'
                                    }}
                                >
                                    {/* Front of card */}
                                    <div
                                        className="absolute w-full h-full rounded-lg flex items-center justify-center border-2 border-purple-500 shadow-lg"
                                        style={{
                                            backfaceVisibility: 'hidden',
                                            background: 'linear-gradient(135deg, #1e1b4b 0%, #4c1d95 100%)',
                                            boxShadow: '0 0 20px rgba(139, 92, 246, 0.5), inset 0 0 30px rgba(139, 92, 246, 0.2)'
                                        }}
                                    >
                                        <div className="text-6xl text-purple-300 animate-pulse" style={{textShadow: '0 0 15px rgba(168, 85, 247, 0.9)'}}>
                                            {arcaneSymbols[index]}
                                        </div>
                                    </div>

                                    {/* Back of card */}
                                    <div
                                        className="absolute w-full h-full rounded-lg flex items-center justify-center border-2 shadow-lg"
                                        style={{
                                            backfaceVisibility: 'hidden',
                                            transform: 'rotateY(180deg)',
                                            background: symbol === 'üòè' 
                                                ? 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)'
                                                : 'linear-gradient(135deg, #450a0a 0%, #7f1d1d 100%)',
                                            borderColor: symbol === 'üòè' ? '#3b82f6' : '#dc2626',
                                            boxShadow: symbol === 'üòè'
                                                ? '0 0 25px rgba(59, 130, 246, 0.6)'
                                                : '0 0 25px rgba(220, 38, 38, 0.6)'
                                        }}
                                    >
                                        <div className="text-7xl filter drop-shadow-lg">
                                            {symbol}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="text-purple-300 text-sm opacity-60 text-center max-w-md">
                        All 6 players share this mystical reading. Click one card per round...
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CardFlipGame />, document.getElementById('root'));
    </script>
</body>
</html>
